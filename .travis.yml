dist: xenial
language: java
jdk: openjdk8

services:
  - docker

addons:
  firefox: "43.0.1"

git:
  quiet: true

cache:
  directories:
    - $HOME/.m2/repository

branches:
  only:
    - /^SP\/.+$/
    - /feature\/.*/

env:
  global:
    - DISPLAY=:99.0

stages:
  - test

before_install: travis_retry bash scripts/travis/init.sh

jobs:
  include:   
#    - name: "Share PO - Part 1"
#      stage: test
#      install: mvn clean install -DskipTests -PenterpriseDocker
#      before_script:
#        - bash scripts/travis/start-compose.sh share-po/docker-compose.yml
#        - bash scripts/travis/wait-for-alfresco-start.sh "http://localhost:8080/alfresco"
#        - cd share-po
#      script:
#        - xvfb-run -a --server-args="-screen 0 1920x1080x24" mvn clean install -B -U -Pdefault,single-test-suite -DskipTests=false -Dwebdriver.local.grid=true -Dwebdriver.browser=RemoteFireFox -Dwebdriver.localGrid=false -Dwebdriver.element.wait.time=20000 -Dwebdriver.page.render.wait.time=60000 -Dshare.target=http://127.0.0.1:8080/share -Dshare.url=http://127.0.0.1:8080/share -Dsuite.filename=src/test/resources/TravisSharePoPart1.xml
#
#    - name: "Share PO - Part 2"
#      stage: test
#      install: mvn clean install -DskipTests -PenterpriseDocker
#      before_script:
#        - bash scripts/travis/start-compose.sh share-po/docker-compose.yml
#        - bash scripts/travis/wait-for-alfresco-start.sh "http://localhost:8080/alfresco"
#        - cd share-po
#      script:
#        - xvfb-run -a --server-args="-screen 0 1920x1080x24" mvn clean install -B -U -Pdefault,single-test-suite -DskipTests=false -Dwebdriver.local.grid=true -Dwebdriver.browser=RemoteFireFox -Dwebdriver.localGrid=false -Dwebdriver.element.wait.time=20000 -Dwebdriver.page.render.wait.time=60000 -Dshare.target=http://127.0.0.1:8080/share -Dshare.url=http://127.0.0.1:8080/share -Dsuite.filename=src/test/resources/TravisSharePoPart2.xml
#
#    - name: "Share PO - Part 3"
#      stage: test
#      install: mvn clean install -DskipTests -PenterpriseDocker
#      before_script:
#        - bash scripts/travis/start-compose.sh share-po/docker-compose.yml
#        - bash scripts/travis/wait-for-alfresco-start.sh "http://localhost:8080/alfresco"
#        - cd share-po
#      script:
#        - xvfb-run -a --server-args="-screen 0 1920x1080x24" mvn clean install -B -U -Pdefault,single-test-suite -DskipTests=false -Dwebdriver.local.grid=true -Dwebdriver.browser=RemoteFireFox -Dwebdriver.localGrid=false -Dwebdriver.element.wait.time=20000 -Dwebdriver.page.render.wait.time=60000 -Dshare.target=http://127.0.0.1:8080/share -Dshare.url=http://127.0.0.1:8080/share -Dsuite.filename=src/test/resources/TravisSharePoPart3.xml
#
#    - name: "Share PO - Part 4"
#      stage: test
#      install: mvn clean install -DskipTests -PenterpriseDocker
#      before_script:
#        - bash scripts/travis/start-compose.sh share-po/docker-compose.yml
#        - bash scripts/travis/wait-for-alfresco-start.sh "http://localhost:8080/alfresco"
#        - cd share-po
#      script:
#        - xvfb-run -a --server-args="-screen 0 1920x1080x24" mvn clean install -B -U -Pdefault,single-test-suite -DskipTests=false -Dwebdriver.local.grid=true -Dwebdriver.browser=RemoteFireFox -Dwebdriver.localGrid=false -Dwebdriver.element.wait.time=20000 -Dwebdriver.page.render.wait.time=60000 -Dshare.target=http://127.0.0.1:8080/share -Dshare.url=http://127.0.0.1:8080/share -Dsuite.filename=src/test/resources/TravisSharePoPart4.xml
#
#    - name: "Share PO - Part 5"
#      stage: test
#      install: mvn clean install -DskipTests -PenterpriseDocker
#      before_script:
#        - bash scripts/travis/start-compose.sh share-po/docker-compose.yml
#        - bash scripts/travis/wait-for-alfresco-start.sh "http://localhost:8080/alfresco"
#        - cd share-po
#      script:
#        - xvfb-run -a --server-args="-screen 0 1920x1080x24" mvn clean install -B -U -Pdefault,single-test-suite -DskipTests=false -Dwebdriver.local.grid=true -Dwebdriver.browser=RemoteFireFox -Dwebdriver.localGrid=false -Dwebdriver.element.wait.time=20000 -Dwebdriver.page.render.wait.time=60000 -Dshare.target=http://127.0.0.1:8080/share -Dshare.url=http://127.0.0.1:8080/share -Dsuite.filename=src/test/resources/TravisSharePoPart5.xml
#
#    - name: "Share PO - Part 6"
#      stage: test
#      install: mvn clean install -DskipTests -PenterpriseDocker
#      before_script:
#        - bash scripts/travis/start-compose.sh share-po/docker-compose.yml
#        - bash scripts/travis/wait-for-alfresco-start.sh "http://localhost:8080/alfresco"
#        - cd share-po
#      script:
#        - xvfb-run -a --server-args="-screen 0 1920x1080x24" mvn clean install -B -U -Pdefault,single-test-suite -DskipTests=false -Dwebdriver.local.grid=true -Dwebdriver.browser=RemoteFireFox -Dwebdriver.localGrid=false -Dwebdriver.element.wait.time=20000 -Dwebdriver.page.render.wait.time=60000 -Dshare.target=http://127.0.0.1:8080/share -Dshare.url=http://127.0.0.1:8080/share -Dsuite.filename=src/test/resources/TravisSharePoPart6.xml

    - name: "Share PO - Flaky Tests"
      stage: test
      install: mvn clean install -DskipTests -PenterpriseDocker
      before_script:
        - bash scripts/travis/start-compose.sh share-po/docker-compose.yml
        - bash scripts/travis/wait-for-alfresco-start.sh "http://localhost:8080/alfresco"
        - cd share-po
      script:
        - xvfb-run -a --server-args="-screen 0 1920x1080x24" mvn clean install -U -Pdefault,single-test-suite -DskipTests=false -Dwebdriver.local.grid=true -Dwebdriver.browser=RemoteFireFox -Dwebdriver.localGrid=false -Dwebdriver.element.wait.time=20000 -Dwebdriver.page.render.wait.time=60000 -Dshare.target=http://127.0.0.1:8080/share -Dshare.url=http://127.0.0.1:8080/share -Dsuite.filename=src/test/resources/TravisSharePoFlaky.xml
