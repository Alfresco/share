dist: xenial
language: java
jdk: openjdk8

services:
  - docker

addons:
  firefox: "43.0.1"

git:
  quiet: true

cache:
  directories:
    - $HOME/.m2/repository

branches:
  only:
    - /^SP\/.+$/
    - /feature\/.*/

env:
  global:
    - DISPLAY=:99.0

stages:
  - test

before_install: travis_retry bash scripts/travis/init.sh

jobs:
  include:   
    - name: "Testing"
      stage: test
      install: mvn clean install -DskipTests -PenterpriseDocker
      before_script:
        - bash scripts/travis/start-compose.sh share-po/docker-compose.yml
        - bash scripts/travis/wait-for-alfresco-start.sh "http://localhost:8080/alfresco"
        - cd share-po
      script:
        # -Dtest.exclude=.*Bug42,.*Bug,chromeOnly,Hybrid,download,NonGrid -Dtest.include=unit,alfresco-one,Enterprise4.2,Enterprise-only -Dtestng.suite.filename=src/test/resources/testng_share_po.xml
        - xvfb-run -a --server-args="-screen 0 1920x1080x24" mvn clean install -B -U -Pdefault -DskipTests=false -Dwebdriver.local.grid=true -Dwebdriver.browser=RemoteFireFox -Dwebdriver.localGrid=false -Dwebdriver.element.wait.time=20000 -Dwebdriver.page.render.wait.time=60000 -Dshare.target=http://127.0.0.1:8080/share -Dshare.url=http://127.0.0.1:8080/share -Dtest.exclude=.*Bug42,.*Bug,chromeOnly,Hybrid,download,NonGrid -Dtestng.suite.filename=src/test/resources/AdminConsoleSuite.xml
